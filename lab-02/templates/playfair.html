<!DOCTYPE html>
<html lang="en">

<head>
    <title>Playfair Cipher</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" rel="stylesheet" />
    <style>
        .result-box {
            margin-top: 20px;
            padding: 15px;
            border-radius: 5px;
            background-color: #f8f9fa;
            border: 1px solid #dee2e6;
        }
    </style>
</head>

<body>
    <div class="container">
        <table class="table">
            <!-- Tiêu đề -->
            <tr>
                <td style="text-align: center; font-weight: bold; font-size: 25px;">PLAYFAIR CIPHER</td>
            </tr>

            <!-- Phần mã hóa -->
            <tr>
                <td style="font-weight: bold; color: blue;">ENCRYPTION</td>
            </tr>
            <tr>
                <td>
                    <form id="encryptForm">
                        <div class="mb-3">
                            <label class="form-label">Plain text:</label>
                            <input type="text" class="form-control" id="inputPlainText" placeholder="Input Plain Text"
                                required autofocus>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Key:</label>
                            <input type="text" class="form-control" id="inputKeyPlain" placeholder="Input Key" required>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="encrypt()">Encrypt</button>
                    </form>
                    <div id="encryptResult" class="result-box" style="display: none;">
                        <strong>Kết quả mã hóa:</strong>
                        <span id="encryptedText" class="font-weight-bold text-success"></span>
                    </div>
                </td>
            </tr>

            <!-- Phần giải mã -->
            <tr>
                <td style="font-weight: bold; color: blue;">DECRYPTION</td>
            </tr>
            <tr>
                <td>
                    <form id="decryptForm">
                        <div class="mb-3">
                            <label class="form-label">Cipher text:</label>
                            <input type="text" class="form-control" id="inputCipherText" placeholder="Input Cipher Text"
                                required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Key:</label>
                            <input type="text" class="form-control" id="inputKeyCipher" placeholder="Input Key"
                                required>
                        </div>
                        <button type="button" class="btn btn-primary" onclick="decrypt()">Decrypt</button>
                    </form>
                    <div id="decryptResult" class="result-box" style="display: none;">
                        <strong>Kết quả giải mã:</strong>
                        <span id="decryptedText" class="font-weight-bold text-success"></span>
                    </div>
                </td>
            </tr>
        </table>
    </div>

    <script>
        // Hàm mã hóa Playfair
        function encrypt() {
            const plainText = document.getElementById('inputPlainText').value.toUpperCase().replace(/J/g, "I");
            const key = document.getElementById('inputKeyPlain').value.toUpperCase().replace(/J/g, "I");

            // Tạo ma trận Playfair từ key
            const matrix = createPlayfairMatrix(key);

            // Mã hóa văn bản
            const cipherText = playfairEncrypt(plainText, matrix);

            // Hiển thị kết quả
            document.getElementById('encryptedText').textContent = cipherText;
            document.getElementById('encryptResult').style.display = 'block';
        }

        // Hàm giải mã Playfair
        function decrypt() {
            const cipherText = document.getElementById('inputCipherText').value.toUpperCase();
            const key = document.getElementById('inputKeyCipher').value.toUpperCase().replace(/J/g, "I");

            // Tạo ma trận Playfair từ key
            const matrix = createPlayfairMatrix(key);

            // Giải mã văn bản
            const plainText = playfairDecrypt(cipherText, matrix);

            // Hiển thị kết quả
            document.getElementById('decryptedText').textContent = plainText;
            document.getElementById('decryptResult').style.display = 'block';
        }

        // Tạo ma trận Playfair từ khóa
        function createPlayfairMatrix(key) {
            const alphabet = "ABCDEFGHIKLMNOPQRSTUVWXYZ";
            let matrix = [];
            let usedChars = new Set();

            // Thêm các ký tự từ khóa (không trùng)
            for (let char of key) {
                if (!usedChars.has(char) && alphabet.includes(char)) {
                    matrix.push(char);
                    usedChars.add(char);
                }
            }

            // Thêm các ký tự còn lại của bảng chữ cái
            for (let char of alphabet) {
                if (!usedChars.has(char)) {
                    matrix.push(char);
                }
            }

            // Chia thành ma trận 5x5
            let playfairMatrix = [];
            for (let i = 0; i < 5; i++) {
                playfairMatrix.push(matrix.slice(i * 5, i * 5 + 5));
            }

            return playfairMatrix;
        }

        // Mã hóa Playfair
        function playfairEncrypt(text, matrix) {
            // Chuẩn bị văn bản: loại bỏ khoảng trắng, thay J bằng I, thêm X nếu cần
            let preparedText = text.replace(/[^A-Z]/g, "");
            let pairs = [];

            // Tạo các cặp ký tự
            for (let i = 0; i < preparedText.length; i += 2) {
                let pair = preparedText.substr(i, 2);
                if (pair.length === 1) pair += "X";
                if (pair[0] === pair[1]) pair = pair[0] + "X";
                pairs.push(pair);
            }

            // Mã hóa từng cặp
            let result = "";
            for (let pair of pairs) {
                const [a, b] = pair.split('');
                const posA = findPosition(a, matrix);
                const posB = findPosition(b, matrix);

                // Cùng hàng
                if (posA.row === posB.row) {
                    result += matrix[posA.row][(posA.col + 1) % 5];
                    result += matrix[posB.row][(posB.col + 1) % 5];
                }
                // Cùng cột
                else if (posA.col === posB.col) {
                    result += matrix[(posA.row + 1) % 5][posA.col];
                    result += matrix[(posB.row + 1) % 5][posB.col];
                }
                // Hình chữ nhật
                else {
                    result += matrix[posA.row][posB.col];
                    result += matrix[posB.row][posA.col];
                }
            }

            return result;
        }

        // Giải mã Playfair
        function playfairDecrypt(text, matrix) {
            let preparedText = text.replace(/[^A-Z]/g, "");
            let pairs = [];

            // Tạo các cặp ký tự
            for (let i = 0; i < preparedText.length; i += 2) {
                pairs.push(preparedText.substr(i, 2));
            }

            // Giải mã từng cặp
            let result = "";
            for (let pair of pairs) {
                const [a, b] = pair.split('');
                const posA = findPosition(a, matrix);
                const posB = findPosition(b, matrix);

                // Cùng hàng
                if (posA.row === posB.row) {
                    result += matrix[posA.row][(posA.col - 1 + 5) % 5];
                    result += matrix[posB.row][(posB.col - 1 + 5) % 5];
                }
                // Cùng cột
                else if (posA.col === posB.col) {
                    result += matrix[(posA.row - 1 + 5) % 5][posA.col];
                    result += matrix[(posB.row - 1 + 5) % 5][posB.col];
                }
                // Hình chữ nhật
                else {
                    result += matrix[posA.row][posB.col];
                    result += matrix[posB.row][posA.col];
                }
            }

            // Loại bỏ các ký tự X thừa
            if (result.endsWith("X")) {
                result = result.slice(0, -1);
            }

            return result.replace(/X(.)/g, function (match, p1) {
                return p1 === match[0] ? p1 : match;
            });
        }

        // Tìm vị trí của ký tự trong ma trận
        function findPosition(char, matrix) {
            for (let row = 0; row < 5; row++) {
                for (let col = 0; col < 5; col++) {
                    if (matrix[row][col] === char) {
                        return { row, col };
                    }
                }
            }
            return { row: -1, col: -1 };
        }
    </script>
</body>

</html>